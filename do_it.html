<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Task Tracker</title>
  <style>
    /* same as your original styling */
    body { font-family: 'Segoe UI', sans-serif; margin: 40px; background: #f0f4f8; }
    h2 { color: #333; margin-bottom: 20px; }
    form { background: #fff; padding: 20px; border-radius: 8px; max-width: 850px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 30px; }
    .form-grid { display: flex; flex-wrap: wrap; gap: 20px; }
    .form-group { flex: 1 1 300px; display: flex; flex-direction: column; }
    .form-group.full-width { flex: 1 1 100%; }
    label { margin-bottom: 5px; font-weight: 600; color: #444; }
    select, input[type="date"], textarea, input[type="file"] { padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 15px; }
    textarea { resize: vertical; }
    #dropZone { border: 2px dashed #aaa; padding: 20px; text-align: center; background: #f9f9f9; cursor: pointer; border-radius: 5px; transition: background 0.3s; }
    #dropZone.dragover { background: #d6e4ff; }
    .preview-area, .doc-area { display: flex; flex-wrap: wrap; margin-top: 10px; }
    .preview-item, .doc-item { position: relative; margin-right: 10px; margin-bottom: 10px; }
    .preview-item img { max-width: 100px; max-height: 100px; border: 1px solid #ccc; border-radius: 5px; }
    .doc-item a { display: inline-block; padding: 6px 10px; background: #007bff; color: white; border-radius: 4px; text-decoration: none; font-size: 14px; }
    .remove-btn { position: absolute; top: -8px; right: -8px; background: red; color: #fff; border-radius: 50%; width: 20px; height: 20px; text-align: center; line-height: 20px; cursor: pointer; font-size: 14px; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    thead { background: #007BFF; color: white; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
    .task-img { max-width: 60px; max-height: 60px; margin-right: 5px; border-radius: 5px; }
    .delete-btn { color: #dc3545; cursor: pointer; font-weight: bold; }
    .edit-btn { color: #28a745; cursor: pointer; font-weight: bold; margin-right: 8px; }
    .button-group { margin-top: 20px; }
    button { padding: 10px 18px; background: #007BFF; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-size: 15px; transition: background 0.3s; }
    button:hover { background: #0056b3; }
    button.danger { background: #dc3545; margin-left: 10px; }
    .stats { margin-bottom: 20px; display: flex; gap: 20px; font-weight: bold; }
    .stats div { background: #fff; padding: 10px 20px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h2>Smart Task Tracker</h2>
  <form id="taskForm">
    <div class="form-grid">
      <div class="form-group">
        <label for="subject">Subject</label>
        <select id="subject" name="subject" required oninvalid="this.setCustomValidity('Please select a subject')" oninput="this.setCustomValidity('')">
          <option value="">Select subject</option>
          <option value="PODF">PODF</option>
          <option value="DSCA">DSCA</option>
          <option value="DT">DT</option>
          <option value="WP">WP</option>
          <option value="ESS">ESS</option>
          <option value="APS">APS</option>
          <option value="DSA">DSA</option>
          <option value="CYSE">CYSE</option>
          <option value="AEM">AEM</option>
          <option value="IT">IT</option>
          <option value="FOUNDATIONS">FOUNDATIONS</option>
        </select>
      </div>
      <div class="form-group">
        <label for="type">Type</label>
        <select id="type" name="type" required oninvalid="this.setCustomValidity('Please select a type')" oninput="this.setCustomValidity('')">
          <option value="">Select type</option>
          <option value="Assignment">Assignment</option>
          <option value="Lab">Lab</option>
          <option value="Project">Project</option>
          <option value="Notes">Notes</option>
          <option value="QUIZ/TEST">QUIZ/TEST</option>
          <option value="INTERNAL EXAM">INTERNAL EXAM</option>
          <option value="EXTERNAL EXAM">EXTERNAL EXAM</option>
        </select>
      </div>
      <div class="form-group full-width">
        <label for="details">What needs to be done?</label>
        <textarea id="details" name="details" rows="2" required></textarea>
      </div>
      <div class="form-group full-width">
        <label>Paste or Drag & Drop Images</label>
        <div id="dropZone">Drop or paste images here</div>
        <div id="previewArea" class="preview-area"></div>
      </div>
      <div class="form-group full-width">
        <label for="docInput">Upload Document (optional)</label>
        <input type="file" id="docInput" accept=".pdf,.doc,.docx,.txt" />
        <div id="docArea" class="doc-area"></div>
      </div>
      <div class="form-group">
        <label for="dueDate">Due Date</label>
        <input type="date" id="dueDate" name="dueDate" required />
      </div>
      <div class="form-group">
        <label for="status">Status</label>
        <select id="status" name="status" required>
          <option value="Pending">Pending</option>
          <option value="Under Progress">Under Progress</option>
          <option value="Completed">Completed</option>
        </select>
      </div>
    </div>
    <div class="button-group">
      <button type="submit" id="saveBtn">Add Task</button>
      <button type="button" id="cancelEditBtn" class="danger" style="display:none;">Cancel Edit</button>
    </div>
  </form>

  <div class="stats">
    <div>Total: <span id="total">0</span></div>
    <div>Pending: <span id="pending">0</span></div>
    <div>Under Progress: <span id="progress">0</span></div>
    <div>Completed: <span id="completed">0</span></div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Subject</th><th>Type</th><th>Details</th><th>Images</th><th>Document</th><th>Due Date</th><th>Status</th><th>Actions</th>
      </tr>
    </thead>
    <tbody id="taskTable"></tbody>
  </table>

  <script>
    const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
    let currentImages = [], currentDoc = null, editIndex = null;

    const form = document.getElementById('taskForm'),
          dropZone = document.getElementById('dropZone'),
          previewArea = document.getElementById('previewArea'),
          docInput = document.getElementById('docInput'),
          docArea = document.getElementById('docArea'),
          cancelEditBtn = document.getElementById('cancelEditBtn'),
          saveBtn = document.getElementById('saveBtn');

    function renderPreview() {
      previewArea.innerHTML = '';
      currentImages.forEach((src, i) => {
        const div = document.createElement('div');
        div.className = 'preview-item';
        div.innerHTML = `<img src="${src}" alt="preview"/><div class="remove-btn" onclick="removeImage(${i})">×</div>`;
        previewArea.appendChild(div);
      });
    }

    function renderDoc() {
      docArea.innerHTML = '';
      if (currentDoc) {
        const div = document.createElement('div');
        div.className = 'doc-item';
        div.innerHTML = `<a href="${currentDoc.url}" target="_blank">${currentDoc.name}</a><div class="remove-btn" onclick="removeDoc()">×</div>`;
        docArea.appendChild(div);
      }
    }

    function removeImage(i) { currentImages.splice(i, 1); renderPreview(); }
    function removeDoc()      { currentDoc = null; renderDoc(); }

    function handleFiles(files, isImage = true) {
      Array.from(files).forEach(file => {
        if (isImage && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = () => { currentImages.push(reader.result); renderPreview(); };
          reader.readAsDataURL(file);
        }
      });
    }

    dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', e => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', e => {
      e.preventDefault(); dropZone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    document.addEventListener('paste', e => {
      const items = Array.from(e.clipboardData.items).filter(it => it.type.indexOf('image') === 0);
      if (items.length) {
        items.forEach(item => {
          const file = item.getAsFile();
          handleFiles([file]);
        });
      }
    });

    docInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      if (file.size > 2 * 1024 * 1024) {
        alert("Document too large (max 2MB)");
        return;
      }
      const reader = new FileReader();
      reader.onload = () => { currentDoc = { name: file.name, url: reader.result }; renderDoc(); };
      reader.readAsDataURL(file);
    });

    form.onsubmit = e => {
      e.preventDefault();
      const task = {
        subject: form.subject.value, type: form.type.value,
        details: form.details.value, dueDate: form.dueDate.value,
        status: form.status.value, images: [...currentImages], document: currentDoc
      };
      editIndex !== null ? tasks[editIndex] = task : tasks.push(task);
      localStorage.setItem('tasks', JSON.stringify(tasks));
      renderTasks(); resetForm();
    };

    function resetForm() {
      form.reset();
      form.subject.selectedIndex = 0;
      form.type.selectedIndex = 0;
      form.status.selectedIndex = 0;
      currentImages = []; currentDoc = null; editIndex = null;
      renderPreview(); renderDoc();
      saveBtn.innerText = 'Add Task';
      cancelEditBtn.style.display = 'none';
    }

    cancelEditBtn.onclick = resetForm;

    function renderTasks() {
      const table = document.getElementById('taskTable');
      table.innerHTML = '';
      let pending = 0, progress = 0, completed = 0;
      tasks.forEach((t, i) => {
        const tr = document.createElement('tr');
        const today = new Date().toISOString().split('T')[0];
        if (t.dueDate < today && t.status !== 'Completed') tr.style.backgroundColor = '#ffe0e0';
        tr.innerHTML = `
          <td>${t.subject}</td><td>${t.type}</td><td>${t.details}</td>
          <td>${t.images.map(img => `<img src="${img}" class="task-img" alt="task image">`).join('')}</td>
          <td>${t.document ? `<a href="${t.document.url}" target="_blank">${t.document.name}</a>` : ''}</td>
          <td>${t.dueDate}</td>
          <td><select onchange="updateStatus(${i}, this.value)">
            <option value="Pending"${t.status==='Pending'?' selected':''}>Pending</option>
            <option value="Under Progress"${t.status==='Under Progress'?' selected':''}>Under Progress</option>
            <option value="Completed"${t.status==='Completed'?' selected':''}>Completed</option>
          </select></td>
          <td><span class="edit-btn" onclick="editTask(${i})">Edit</span><span class="delete-btn" onclick="deleteTask(${i})">Delete</span></td>`;
        table.appendChild(tr);
        if (t.status === 'Pending') pending++;
        else if (t.status === 'Under Progress') progress++;
        else completed++;
      });
      total.innerText = tasks.length;
      pendingElem.innerText = pending;
      progressElem.innerText = progress;
      completedElem.innerText = completed;
    }

    window.editTask = i => {
      const t = tasks[i];
      form.subject.value = t.subject;
      form.type.value = t.type;
      form.details.value = t.details;
      form.dueDate.value = t.dueDate;
      form.status.value = t.status;
      currentImages = [...t.images];
      currentDoc = t.document ? { ...t.document } : null;
      editIndex = i;
      renderPreview(); renderDoc();
      saveBtn.innerText = 'Update Task';
      cancelEditBtn.style.display = 'inline-block';
    };

    window.deleteTask = i => {
      if (confirm('Are you sure you want to delete this task?')) {
        tasks.splice(i, 1);
        localStorage.setItem('tasks', JSON.stringify(tasks));
        renderTasks();
      }
    };

    window.updateStatus = (i, newStatus) => {
      tasks[i].status = newStatus;
      localStorage.setItem('tasks', JSON.stringify(tasks));
      renderTasks();
    };

    const total = document.getElementById('total'),
          pendingElem = document.getElementById('pending'),
          progressElem = document.getElementById('progress'),
          completedElem = document.getElementById('completed');

    renderTasks();
  </script>
</body>
</html>
